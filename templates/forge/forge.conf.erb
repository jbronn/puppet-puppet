<VirtualHost _default_:80>
  ServerName <%= @server_name %>
  ServerAdmin <%= @server_admin %>

  # Allow Apache to access the directory with the WSGI file.
  <Directory <%= @forge_apache %>>
    Options -Indexes
    <Files <%= File.basename(@forge_wsgi) %>>
      Order deny,allow
      Allow from all
    </Files>
  </Directory>

  # Telling Apache about the WSGI file.
  WSGIDaemonProcess forge processes=<%= @processes %>
  WSGIProcessGroup forge
  WSGIScriptAlias / <%= @forge_wsgi %>

  # Django media.
  Alias /system/releases/ "<%= @releases %>/"
  <Directory "<%= @releases %>">
    Options -Indexes
    Order deny,allow
    Allow from all
  </Directory>

  Alias /static/ "<%= @static %>/"
  <Directory "<%= @static %>">
    Options -Indexes
    Order deny,allow
    Allow from all
  </Directory>

  # Logjammin'
  LogLevel warn
  ErrorLog <%= scope.lookupvar('apache::params::logs') %>/forge_error.log
  CustomLog <%= scope.lookupvar('apache::params::logs') %>/forge_access.log combined
</VirtualHost>

<% if @ssl_cert and @ssl_key -%>
<VirtualHost _default_:443>
  ServerName <%= @server_name %>
  ServerAdmin <%= @server_admin %>

  # SSL Settings
  SSLEngine on
  SSLCertificateFile <%= @ssl_cert %>
  SSLCertificateKeyFile <%= @ssl_key %>
<% if @ssl_chain -%>
  SSLCertificateChainFile <%= @ssl_chain %>
<% end -%>

  # Allow Apache to access the directory with the WSGI file.
  <Directory <%= @forge_apache %>>
    Options -Indexes
    <Files <%= File.basename(@forge_wsgi) %>>
      Order deny,allow
      Allow from all
    </Files>
  </Directory>

  # Telling Apache about the WSGI file.
  WSGIDaemonProcess forge_secure processes=<%= @processes %>
  WSGIProcessGroup forge_secure
  WSGIScriptAlias / <%= @forge_wsgi %>

  # Django media.
  Alias /system/releases/ "<%= @releases %>/"
  <Directory "<%= @releases %>">
    Options -Indexes
    Order deny,allow
    Allow from all
  </Directory>

  Alias /static/ "<%= @static %>/"
  <Directory "<%= @static %>">
    Options -Indexes
    Order deny,allow
    Allow from all
  </Directory>

  # Logjammin'
  LogLevel warn
  ErrorLog <%= scope.lookupvar('apache::params::logs') %>/forge_secure_error.log
  CustomLog <%= scope.lookupvar('apache::params::logs') %>/forge_secure_access.log combined
</VirtualHost>
<% end -%>
